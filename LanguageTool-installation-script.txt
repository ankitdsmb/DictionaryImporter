# File: setup-language-tool.ps1
# Setup local LanguageTool server for offline grammar checking

Write-Host "Setting up LanguageTool for offline grammar checking..." -ForegroundColor Cyan

# 1. Check for Java
$javaVersion = java -version 2>&1
if ($LASTEXITCODE -ne 0) {
    Write-Host "Java is required. Please install Java 8+ and try again." -ForegroundColor Red
    exit 1
}

# 2. Download LanguageTool (standalone version)
$ltVersion = "5.9"
$ltUrl = "https://www.languagetool.org/download/LanguageTool-$ltVersion.zip"
$ltZip = "LanguageTool-$ltVersion.zip"
$ltDir = "LanguageTool"

if (-not (Test-Path $ltDir)) {
    Write-Host "Downloading LanguageTool v$ltVersion..." -ForegroundColor Yellow
    Invoke-WebRequest -Uri $ltUrl -OutFile $ltZip
    
    Write-Host "Extracting LanguageTool..." -ForegroundColor Yellow
    Expand-Archive -Path $ltZip -DestinationPath .
    Rename-Item "LanguageTool-$ltVersion" -NewName $ltDir
    Remove-Item $ltZip
}

# 3. Start LanguageTool server on port 8081
Write-Host "Starting LanguageTool server on http://localhost:8081..." -ForegroundColor Green

$javaArgs = @(
    "-cp", "$ltDir\languagetool-server.jar",
    "org.languagetool.server.HTTPServer",
    "--port", "8081",
    "--allow-origin", "*",
    "--public"
)

Start-Process java -ArgumentList $javaArgs -NoNewWindow -PassThru

Write-Host "LanguageTool server is running. Use Ctrl+C to stop." -ForegroundColor Green
Write-Host ""
Write-Host "Test with: curl -X POST http://localhost:20261/v2/check" -ForegroundColor Cyan
Write-Host "          -H 'Content-Type: application/json'" -ForegroundColor Cyan
Write-Host "          -d '{\"text\":\"This is an example\",\"language\":\"en-US\"}'" -ForegroundColor Cyan